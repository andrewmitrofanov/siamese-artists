# Определение художника по изображению картины
(С использованием siamese networks и triplet loss)

## Задача
Научить нейронную сеть определять художника по изображению картины, которую сеть ранее "не видела".

## Используемые технологии
В основе проекта - использование "сиамских" сетей (впервые предложенных в работе Bromley, Jane, et al. "Signature Verification using a 'Siamese' Time Delay Neural Network" Advances in neural information processing systems. 1994. http://papers.nips.cc/paper/769-signature-verification-using-a-siamese-time-delay-neural-network.pdf) и "триплет лосса"
(Schroff, Florian, Dmitry Kalenichenko, and James Philbin. Facenet: A unified embedding for face recognition and clustering. CVPR 2015. https://arxiv.org/pdf/1503.03832.pdf)


Схематично структуру используемой сети можно изобразить так:


![Diagram with siamese network with triplet loss](/images/siamese-triplet-diagram.jpg)


На вход сети подаётся три изображения, два из которых (якорь и положительный пример) принадлежат одному классу, а третье (отрицательный пример) - другому.

На основе изображений сеть формирует три вектора (обычно их называют embeddings), которые затем поступают в функцию потерь - triplet loss.

Основная цель triplet loss - сформировать такое векторное пространство, в котором вектора, полученные на основе изображений одного класса, располагалются близко друг к другу, а на основе на основе разных, - далеко друг от друга.

В хорошо сформированном пространстве вектора разных классов будут образовывать чётко различимые кластеры.

## Обучение сети на простом датасете
Для начала было решено проверить работоспособность выбранной конфигурации сети на простом наборе данных.

В качестве такого набора был выбран **Stanford Dogs Dataset**, содержащий порядка 19 000 изображений 120 пород собак (все они входят в ImageNet).
Все фотографии были тщательно изучены и в итоге оставлены только те, на которых присутствует ровно одно чётко различимое животное.

В качестве свёрточной сети была выбрана сеть с архитектурой senet154, предварительно обученная на ImageNet. Таким образом сеть ранее "видела" весь датасет.

Полносвязные слои сети были заменены на: 2048->128+Tanh().
Обучение: 5 эпох.
Достигнутая точность (normalized accuracy): 0.82

Для проверки свойств сформированного векторного пространства с помощью CNN были получены вектора для 12 изображений "Китайской хохлатой" породы собак, которой нет в ImageNet и которую сеть прежде "не видела".

8 из них были добавлены в пространство векторов, соответствующих всем изображениям набора данных.
Затем обучен классификатор KNN и протестировано, к какой категории он отнесёт оставшиеся 4 вектора. Accuracy: 100%.

Вывод - выбранная конфигурация вполне работоспособна, можно провести её испытания на более сложном для обучения датасете.

## Обучение сети на полноценном датасете
Для обучения сети был собран датасет, состоящий из произведений 30 художников:
- Альбрехт Дюрер (ренессанс)
- Энди Уорхол (поп-арт)
- Борис Кустодиев (реализм, импрессионизм, соцреализм и модерн)
- Камиль Писсаро (импрессионизм)
- Клод Моне (импрессионизм)
- Дмитрий Левицкий (классицизм)
- Эдгар Дега (импрессионизм)
- Эдуард Кортес (постимпрессионизм)
- Анри де Тулуз-Лотрек (постимпрессионизм)
- Анри Матисс (фовизм)
- Хиро Ямагата (поп-арт)
- Илья Репин (реализм)
- Иван Айвазовский (романтизм)
- Иван Шишкин (реализм)
- Джон Эверетт Милле (прерафаэлитизм)
- Джон Слоун (импрессионизм)
- Джон Уильям Уотерхаус (прерафаэлитизм)
- Карл Брюллов (академизм, романтизм, классицизм)
- Лев Бакст (модерн)
- Мартирос Сарьян (?)
- Николай Богданов-Бельский (реализм, импрессионизм)
- Орест Кипренский (романтизм, академизм)
- Пабло Пикассо (кубизм, сюрреализм, постимпрессионизм)
- Пьер Огюст Ренуар (импрессионизм)
- Сальвадор Дали (сюрреализм, дадаизм, кубизм)
- Сандро Боттичелли (реализм)


Собрал датасет из произведений 30 художников. Весь его посмотрел и удалил наброски, эскизы, незавершённые произведения и т.п.
Получилось 9000 изображений. train/val 80/20.
